<!doctype html><html class="h-full w-full font-sans" lang=zh-cn><head><meta charset=utf-8><link rel="shortcut icon" href=http://example.org/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>- My New Hugo Site</title><meta property="og:title" content><meta property="og:description" content="[TOC]
因为禾斗石开需要，安装了中标麒麟高级服务器操作系统（虚拟化版）V6，然后该系统上部署了几个JAVA WEB项目，现在需要安装nginx，但是yum无法使用，出现以下异常信息：
Loaded plugins: refresh-packagekit, security http://****: [Errno 14] PYCURL ERROR 22 - &#34;The requested URL returned error: 404 Not Found&#34; Trying other mirror. Error: Cannot retrieve repository metadata (repomd.xml) for repository: base. Please verify its path and try again 修改yum源改为163 cd /etc/yum.repos.d/ # 备份原有的源 mv ns6-gen-x86_64.repo ns6-gen-x86_64.repo.old # 下载网易163的源 wget http://mirrors.163.com/.help/CentOS6-Base-163.repo mv CentOS6-Base-163.repo CentOS-Base.repo yum clean all yum makecache 但在 yum makecache报错：
http://mirrors.163.com/centos/6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - &#34;The requested URL returned error: 404 Not Found&#34; 尝试其他镜像。错误：Cannot retrieve repository metadata (repomd."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/linux/neokylin_install_nginx/"><meta property="article:section" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="[TOC]
因为禾斗石开需要，安装了中标麒麟高级服务器操作系统（虚拟化版）V6，然后该系统上部署了几个JAVA WEB项目，现在需要安装nginx，但是yum无法使用，出现以下异常信息：
Loaded plugins: refresh-packagekit, security http://****: [Errno 14] PYCURL ERROR 22 - &#34;The requested URL returned error: 404 Not Found&#34; Trying other mirror. Error: Cannot retrieve repository metadata (repomd.xml) for repository: base. Please verify its path and try again 修改yum源改为163 cd /etc/yum.repos.d/ # 备份原有的源 mv ns6-gen-x86_64.repo ns6-gen-x86_64.repo.old # 下载网易163的源 wget http://mirrors.163.com/.help/CentOS6-Base-163.repo mv CentOS6-Base-163.repo CentOS-Base.repo yum clean all yum makecache 但在 yum makecache报错：
http://mirrors.163.com/centos/6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - &#34;The requested URL returned error: 404 Not Found&#34; 尝试其他镜像。错误：Cannot retrieve repository metadata (repomd."><link rel=stylesheet href=/css/styles.pcss integrity=><script>localStorage.theme==='dark'||!('theme'in localStorage)&&window.matchMedia('(prefers-color-scheme: dark)').matches?document.documentElement.classList.add('dark'):document.documentElement.classList.remove('dark')</script></head><body class="flex flex-col items-center w-full"><main class="w-full sm:w-10/12 md:w-9/12 lg:w-7/12 xl:w-5/12 m-auto px-6"><header class="mt-9 mb-8"><div class="flex justify-between items-center"><div class="flex items-center"><input id=navbar_btn class=hidden type=checkbox>
<label for=navbar_btn class="menu-btn mr-4 items-center flex xl:hidden"><span class=navicon></span></label><a href=/ class="font-bold text-lg xl:text-2xl mr-auto">My New Hugo Site</a></div><div class="flex items-center"><div class="cursor-pointer ml-2"><svg id="dark_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 15.31 23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31.0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg></svg><svg id="light_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g><path d="M0 0h24v24H0V0z" fill="none"/></g><g><g><g><path d="M14 2c1.82.0 3.53.5 5 1.35C16.01 5.08 14 8.3 14 12s2.01 6.92 5 8.65C17.53 21.5 15.82 22 14 22 8.48 22 4 17.52 4 12S8.48 2 14 2z"/></g></g></g></svg></svg></div></div></div><nav id=navbar class="mt-3 hidden xl:block"><ul class=flex></ul></nav><nav id=navbar_sm class="mt-2 hidden"><ul></ul><hr class=my-4></nav></header><div id=content class=my-8><div class="collapsible-menu-wrapper my-8 p-4 border-2 rounded"><div class="flex justify-between"><span class=font-bold>Table of contents</span></div><div class="collapsible-menu text-sm ml-2"><div class=leading-6><nav id=TableOfContents><ul><li><a href=#修改yum源改为163>修改yum源改为163</a></li><li><a href=#添加nginx的源>添加nginx的源</a></li><li><a href=#安装pcre>安装pcre</a></li><li><a href=#安装nginx>安装NGINX</a></li><li><a href=#参考链接>参考链接</a></li></ul></nav></div></div></div><div class=my-7><article><p>[TOC]</p><p>因为禾斗石开需要，安装了中标麒麟高级服务器操作系统（虚拟化版）V6，然后该系统上部署了几个JAVA WEB项目，现在需要安装nginx，但是yum无法使用，出现以下异常信息：</p><pre><code>Loaded plugins: refresh-packagekit, security
http://****: [Errno 14] PYCURL ERROR 22 - &quot;The requested URL returned error: 404 Not Found&quot;
Trying other mirror.
Error: Cannot retrieve repository metadata (repomd.xml) for repository: base. Please verify its path and try again
</code></pre><h2 id=修改yum源改为163>修改yum源改为163</h2><pre><code>cd  /etc/yum.repos.d/
# 备份原有的源
mv ns6-gen-x86_64.repo ns6-gen-x86_64.repo.old
# 下载网易163的源
wget http://mirrors.163.com/.help/CentOS6-Base-163.repo
mv CentOS6-Base-163.repo CentOS-Base.repo
yum clean all
yum makecache
</code></pre><p>但在 yum makecache报错：</p><pre><code>http://mirrors.163.com/centos/6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - &quot;The requested URL returned error: 404 Not Found&quot;
尝试其他镜像。错误：Cannot retrieve repository metadata (repomd.xml) for repository: base. Please verify its path and try again
</code></pre><p>这是因为无法访问http://mirrors.163.com/centos/6/os/x86_64/repodata/repomd.xml，repomd.xml 在http://mirrors.163.com/centos/6-6.5下已经不存在，需要更改CentOS-Base.repo此文件中的<code>$releasever</code> 参数，对于CentOS来说，<code>$releasever</code> 来源于 <code>rpm -qi centos-release</code> 的version数值。</p><pre><code># 查询中标麒麟系统的版本
cat /proc/version
Linux version 2.6.32-358.el6.x86_64 (mockbuild@ns60x64.cs2c.com.cn) (gcc version 4.4.7 20120313 (NeoKylin 4.4.7-3) (GCC) ) #1 SMP Fri Jul 12 10:25:19 CST 2013
</code></pre><p>对于中标麒麟高级服务器操作系统（虚拟化版）V6，经过测试，$releasever直接取 ** 6 ** 即可。</p><pre><code>vim  CentOS-Base.repo
#vim命令模式下将所有的$releasever替换为6
:1,s/$releasever/6/g
# 再执行后续的指令
yum clean all
yum makecache
</code></pre><h2 id=添加nginx的源>添加nginx的源</h2><p>根据NGINX官方文档的安装方法：</p><blockquote><p>To add NGINX yum repository, create a file named and paste one of the configurations below:</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cd /etc/yum.repos.d/
<span style=color:#75715e># 新建nginx.repo文件</span>
vim nginx.repo
<span style=color:#75715e># 填写以下内容</span>
<span style=color:#f92672>[</span>nginx<span style=color:#f92672>]</span>
name<span style=color:#f92672>=</span>nginx repo
baseurl<span style=color:#f92672>=</span>http://nginx.org/packages/rhel/$releasever/$basearch/
gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</code></pre></div><p>注意：<code>$releasever</code> 和<code>$basearch</code> 需要根据系统来确定，中标麒麟高级服务器操作系统（虚拟化版）V6最后确定为http://nginx.org/packages/rhel/6/x86_64/</p><h2 id=安装pcre>安装pcre</h2><p>尝试安装<code>yum install nginx</code> , 安装nginx时报错，因为nginx的rewrite需要pcre库。</p><pre><code>./configure: error: the HTTP rewrite module requires the PCRE library.
</code></pre><p>安装pcre-devel解决问题</p><pre><code>yum -y install pcre-devel
</code></pre><p>重新安装nginx依然出现错误提示：</p><pre><code>./configure: error: the HTTP cache module requires md5 functions
from OpenSSL library.   You can either disable the module by using
–without-http-cache option, or install the OpenSSL library into the system,
or build the OpenSSL library statically from the source with nginx by using
–with-http_ssl_module –with-openssl=&amp;lt;path&amp;gt; options.
</code></pre><p>安装openssl相关软件：</p><pre><code>yum -y install openssl openssl-devel
</code></pre><p>安装pcre：</p><pre><code># 下载相应版本的pcre
pcre-8.39.tar.bz2
# 解包解压缩
tar xjpf pcre-8.39.tar.bz2
# 切换到pcre的目录
cd pcre-7.8
# 配置
./configure --prefix=/usr/local/pcre-8.39 --libdir=/usr/local/lib/pcre --includedir=/usr/local/include/pcre
</code></pre><p>configure有许多参数可配，具体参见./configure –help及手册</p><pre><code># 编译及安装
make
make install
</code></pre><h2 id=安装nginx>安装NGINX</h2><p>最后尝试安装<code>yum install nginx</code> ，完成。</p><h2 id=参考链接>参考链接</h2><ul><li><a href=http://461205160.blog.51cto.com/274918/1739813>解决centos 6.6 更换yum 163源报错</a></li><li><a href=http://mirrors.163.com/.help/centos.html>CentOS镜像使用帮助</a></li><li><a href=https://www.nginx.com/resources/wiki/start/topics/tutorials/install/>Install</a></li><li><a href="http://tech.49jie.com/?p=859">PCRE-nginx pcre library not found</a></li></ul></article></div></div></main><script src=/js/header.0b11855b871cb4d10c6c07b6723b9209f5c2bc9100735ab6ff47c8f9b76bb3d6ae41b488083b5fb15697987334039eb651b25c83228c29ac48a2bc168db8a894.js integrity="sha512-CxGFW4cctNEMbAe2cjuSCfXCvJEAc1q2/0fI+bdrs9auQbSICDtfsVaXmHM0A562UbJcgyKMKaxIorwWjbiolA=="></script><script src=/js/zooming.js integrity></script><script src=/js/code-copy-btn.js integrity></script></body></html>