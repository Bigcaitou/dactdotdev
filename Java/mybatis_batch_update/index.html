<!doctype html><html class="h-full w-full font-sans" lang=zh-cn><head><meta charset=utf-8><link rel="shortcut icon" href=http://example.org/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>- My New Hugo Site</title><meta property="og:title" content><meta property="og:description" content="[TOC]
业务需要，要完成批量编辑产品名称。运用Mybatis的批量更新功能，同时因为需要更新的数据是iterator迭代出来的，所以需要在前端做一个标记。
Entity 产品有产品ID、产品名称两个属性：
public class Product extends BaseEntity { /** 产品ID */ private String productId; /** 产品名称 */ private String name; /** 产品列表查询 */ private List productList; //以下省了get和set方法... } Controller @Action(value = &#34;updateProduct&#34;, results = { @Result(name = &#34;success&#34;, location = &#34;/pages/backstage/manage-product-list.jsp&#34;) }) public String updateProduct() { product = new Product(); product.setProductList(productList); UpdateProductService service = new UpdateProductService(); service.setEntity(product); service.excuteService(); return &#34;success&#34;; } Service public class UpdateProductService extends BaseService { protected Object makeService(Product entity, SqlSession sqlSession) { ProductDao dao = sqlSession."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/java/mybatis_batch_update/"><meta property="article:section" content="Java"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="[TOC]
业务需要，要完成批量编辑产品名称。运用Mybatis的批量更新功能，同时因为需要更新的数据是iterator迭代出来的，所以需要在前端做一个标记。
Entity 产品有产品ID、产品名称两个属性：
public class Product extends BaseEntity { /** 产品ID */ private String productId; /** 产品名称 */ private String name; /** 产品列表查询 */ private List productList; //以下省了get和set方法... } Controller @Action(value = &#34;updateProduct&#34;, results = { @Result(name = &#34;success&#34;, location = &#34;/pages/backstage/manage-product-list.jsp&#34;) }) public String updateProduct() { product = new Product(); product.setProductList(productList); UpdateProductService service = new UpdateProductService(); service.setEntity(product); service.excuteService(); return &#34;success&#34;; } Service public class UpdateProductService extends BaseService { protected Object makeService(Product entity, SqlSession sqlSession) { ProductDao dao = sqlSession."><link rel=stylesheet href=/css/styles.pcss integrity=><script>localStorage.theme==='dark'||!('theme'in localStorage)&&window.matchMedia('(prefers-color-scheme: dark)').matches?document.documentElement.classList.add('dark'):document.documentElement.classList.remove('dark')</script></head><body class="flex flex-col items-center w-full"><main class="w-full sm:w-10/12 md:w-9/12 lg:w-7/12 xl:w-5/12 m-auto px-6"><header class="mt-9 mb-8"><div class="flex justify-between items-center"><div class="flex items-center"><input id=navbar_btn class=hidden type=checkbox>
<label for=navbar_btn class="menu-btn mr-4 items-center flex xl:hidden"><span class=navicon></span></label><a href=/ class="font-bold text-lg xl:text-2xl mr-auto">My New Hugo Site</a></div><div class="flex items-center"><div class="cursor-pointer ml-2"><svg id="dark_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 15.31 23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31.0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg></svg><svg id="light_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g><path d="M0 0h24v24H0V0z" fill="none"/></g><g><g><g><path d="M14 2c1.82.0 3.53.5 5 1.35C16.01 5.08 14 8.3 14 12s2.01 6.92 5 8.65C17.53 21.5 15.82 22 14 22 8.48 22 4 17.52 4 12S8.48 2 14 2z"/></g></g></g></svg></svg></div></div></div><nav id=navbar class="mt-3 hidden xl:block"><ul class=flex></ul></nav><nav id=navbar_sm class="mt-2 hidden"><ul></ul><hr class=my-4></nav></header><div id=content class=my-8><div class="collapsible-menu-wrapper my-8 p-4 border-2 rounded"><div class="flex justify-between"><span class=font-bold>Table of contents</span></div><div class="collapsible-menu text-sm ml-2"><div class=leading-6><nav id=TableOfContents><ul><li><ul><li><a href=#entity>Entity</a></li><li><a href=#controller>Controller</a></li><li><a href=#service>Service</a></li><li><a href=#dao>Dao</a></li><li><a href=#sql>Sql</a></li><li><a href=#html>html</a></li><li><a href=#实现效果>实现效果</a></li></ul></li></ul></nav></div></div></div><div class=my-7><article><p>[TOC]</p><p>业务需要，要完成批量编辑产品名称。运用Mybatis的批量更新功能，同时因为需要更新的数据是iterator迭代出来的，所以需要在前端做一个标记。</p><h3 id=entity>Entity</h3><p>产品有产品ID、产品名称两个属性：</p><p><img src=images/product.png alt=product></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>extends</span> BaseEntity <span style=color:#f92672>{</span>
    <span style=color:#75715e>/** 产品ID */</span>
    <span style=color:#66d9ef>private</span> String productId<span style=color:#f92672>;</span>
    <span style=color:#75715e>/** 产品名称 */</span>
    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
    <span style=color:#75715e>/** 产品列表查询 */</span>
    <span style=color:#66d9ef>private</span> List productList<span style=color:#f92672>;</span>
    <span style=color:#75715e>//以下省了get和set方法...
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><h3 id=controller>Controller</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Action</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;updateProduct&#34;</span><span style=color:#f92672>,</span> results <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> <span style=color:#a6e22e>@Result</span><span style=color:#f92672>(</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;success&#34;</span><span style=color:#f92672>,</span> location <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/pages/backstage/manage-product-list.jsp&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>})</span>
<span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>updateProduct</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    product <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Product<span style=color:#f92672>();</span>
    product<span style=color:#f92672>.</span><span style=color:#a6e22e>setProductList</span><span style=color:#f92672>(</span>productList<span style=color:#f92672>);</span>
    UpdateProductService service <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UpdateProductService<span style=color:#f92672>();</span>
    service<span style=color:#f92672>.</span><span style=color:#a6e22e>setEntity</span><span style=color:#f92672>(</span>product<span style=color:#f92672>);</span>
    service<span style=color:#f92672>.</span><span style=color:#a6e22e>excuteService</span><span style=color:#f92672>();</span>
    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;success&#34;</span><span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=service>Service</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UpdateProductService</span> <span style=color:#66d9ef>extends</span> BaseService <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>protected</span> Object <span style=color:#a6e22e>makeService</span><span style=color:#f92672>(</span>Product entity<span style=color:#f92672>,</span> SqlSession sqlSession<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    ProductDao dao <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>ProductDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
    dao<span style=color:#f92672>.</span><span style=color:#a6e22e>updateProduct</span><span style=color:#f92672>(</span>entity<span style=color:#f92672>);</span>
    <span style=color:#66d9ef>return</span> entity<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=dao>Dao</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ProductDao</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>updateProduct</span><span style=color:#f92672>(</span>Product product<span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=sql>Sql</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;insert</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;updateProduct&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;com.xxxxx.product.entity.Product&#34;</span><span style=color:#f92672>&gt;</span>
    replace into product (
        product_id,name
    ) values
    <span style=color:#f92672>&lt;foreach</span> <span style=color:#a6e22e>collection=</span><span style=color:#e6db74>&#34;productList&#34;</span> <span style=color:#a6e22e>item=</span><span style=color:#e6db74>&#34;productList&#34;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#34;index&#34;</span> <span style=color:#a6e22e>separator=</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>&gt;</span>
        (#{productList.productId}, #{productList.name})
    <span style=color:#f92672>&lt;/foreach&gt;</span>
<span style=color:#f92672>&lt;/insert&gt;</span>
<span style=color:#75715e>&lt;!--此处其实就是运用Mybatis的foreach标签来拼sql--&gt;</span>
</code></pre></div><h3 id=html>html</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>body</span>&gt;
    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span>&gt;
    <span style=color:#a6e22e>$</span>(<span style=color:#66d9ef>function</span>() {
        <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#btn-save&#34;</span>).<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;click&#39;</span>, <span style=color:#66d9ef>function</span>() {
            <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#updateProduct&#34;</span>).<span style=color:#a6e22e>submit</span>();
        })
    });
    &lt;/<span style=color:#f92672>script</span>&gt;
    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;panel panel-default&#34;</span>&gt;
        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;panel-heading&#34;</span>&gt;产品列表&lt;/<span style=color:#f92672>div</span>&gt;
        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;panel-body&#34;</span>&gt;
        &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tool-bar&#34;</span>&gt;
            &lt;<span style=color:#f92672>li</span>&gt;
                &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;javascript:void(0);&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn-save&#34;</span>&gt;
                    &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;glyphicon glyphicon-floppy-disk&#34;</span>&gt;
                    &lt;/<span style=color:#f92672>span</span>&gt; 保存
                &lt;/<span style=color:#f92672>a</span>&gt;
            &lt;/<span style=color:#f92672>li</span>&gt;
        &lt;/<span style=color:#f92672>ul</span>&gt;
    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;double-line&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
    &lt;<span style=color:#f92672>s:form</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form&#34;</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;updateProduct&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> <span style=color:#a6e22e>namespace</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/admin&#34;</span> <span style=color:#a6e22e>theme</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;simple&#34;</span>&gt;
    &lt;<span style=color:#f92672>br</span> /&gt;
    &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group&#34;</span>&gt;
    &lt;<span style=color:#f92672>s:iterator</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;product.productList&#34;</span> <span style=color:#a6e22e>status</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;statusTest&#34;</span>&gt;
        &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group-item list-group-item-text&#34;</span>&gt;
            &lt;<span style=color:#f92672>h5</span>&gt;产品列表&lt;/<span style=color:#f92672>h5</span>&gt; 
            &lt;<span style=color:#f92672>s:hidden</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;%{&#39;productList[&#39;+#statusTest.index+&#39;].productId&#39;}&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;%{productId}&#34;</span>&gt;&lt;/<span style=color:#f92672>s:hidden</span>&gt;
            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-group input-group&#34;</span>&gt;
            &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;input-group-addon&#34;</span>&gt; 
                &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;glyphicon glyphicon-pencil&#34;</span>&gt;&lt;/<span style=color:#f92672>span</span>&gt; 标题
            &lt;/<span style=color:#f92672>span</span>&gt;
            &lt;<span style=color:#f92672>s:textfield</span> <span style=color:#a6e22e>cssClass</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;%{&#39;productList[&#39;+#statusTest.index+&#39;].name&#39;}&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;%{name}&#34;</span>&gt;&lt;/<span style=color:#f92672>s:textfield</span>&gt;
            &lt;/<span style=color:#f92672>div</span>&gt;
        &lt;/<span style=color:#f92672>li</span>&gt;
    &lt;/<span style=color:#f92672>s:iterator</span>&gt;
    &lt;/<span style=color:#f92672>ul</span>&gt;
    &lt;/<span style=color:#f92672>s:form</span>&gt;
    &lt;/<span style=color:#f92672>div</span>&gt;
&lt;/<span style=color:#f92672>div</span>&gt;
</code></pre></div><h3 id=实现效果>实现效果</h3><p>如下图所示：</p><p><img src=images/edit-product-4994274.png alt=edit-product></p></article></div></div></main><script src=/js/header.0b11855b871cb4d10c6c07b6723b9209f5c2bc9100735ab6ff47c8f9b76bb3d6ae41b488083b5fb15697987334039eb651b25c83228c29ac48a2bc168db8a894.js integrity="sha512-CxGFW4cctNEMbAe2cjuSCfXCvJEAc1q2/0fI+bdrs9auQbSICDtfsVaXmHM0A562UbJcgyKMKaxIorwWjbiolA=="></script><script src=/js/zooming.js integrity></script><script src=/js/code-copy-btn.js integrity></script></body></html>