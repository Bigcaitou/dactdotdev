<!doctype html><html class="h-full w-full font-sans" lang=zh-cn><head><meta charset=utf-8><link rel="shortcut icon" href=http://example.org/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>- My New Hugo Site</title><meta property="og:title" content><meta property="og:description" content="[TOC]
 因项目需要，现将KindEditor与ckplayer相结合，搭建一个带本地视频播放的cms。
KindEditor  KindEditor的安装与配置这里不做多余介绍，具体参考《官方文档-编辑器使用方法》。
ckplayer的配置  上传相关文件到编辑器的插件目录即editor/plugins/ckplayer，基本的文件包括ckplayer.js、ckplayer.swf、ckplayer.xml、language.xml和style.css。
修改格式验证代码  修改kindeditor.js的960行左右的上传功能的格式验证代码，加入需要支持的视频格式：
function _mediaType(src) { if (/\.(rm|rmvb)(\?|$)/i.test(src)) { return'audio/x-pn-realaudio-plugin'; } if (/\.(swf|flv|mp4)(\?|$)/i.test(src)) { return'application/x-shockwave-flash'; } return'video/x-ms-asf-plugin'; }  修改jsp/upload_json.jsp的32行左右的上传功能的格式验证代码，加入需要支持的视频格式：
//定义允许上传的文件扩展名 HashMap<String, String> extMap = new HashMap<String, String>(); extMap.put(&#34;image&#34;, &#34;gif,jpg,jpeg,png,bmp&#34;); extMap.put(&#34;flash&#34;, &#34;swf,flv,mp4&#34;); extMap.put(&#34;media&#34;, &#34;swf,flv,mp3,wav,wma,wmv,mid,avi,mpg,asf,rm,rmvb,mp4&#34;); extMap.put(&#34;file&#34;, &#34;doc,docx,xls,xlsx,ppt,htm,html,txt,zip,rar,gz,bz2&#34;);  ckplayer官方称支持以下视频格式：
   视频协议 视频格式 Flash HTML5     HTTP flv g.jpg x.jpg   HTTP f4v g.jpg x.jpg   HTTP mp4 g."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/web/kindeditorckplayer/"><meta property="article:section" content="web"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="[TOC]
 因项目需要，现将KindEditor与ckplayer相结合，搭建一个带本地视频播放的cms。
KindEditor  KindEditor的安装与配置这里不做多余介绍，具体参考《官方文档-编辑器使用方法》。
ckplayer的配置  上传相关文件到编辑器的插件目录即editor/plugins/ckplayer，基本的文件包括ckplayer.js、ckplayer.swf、ckplayer.xml、language.xml和style.css。
修改格式验证代码  修改kindeditor.js的960行左右的上传功能的格式验证代码，加入需要支持的视频格式：
function _mediaType(src) { if (/\.(rm|rmvb)(\?|$)/i.test(src)) { return'audio/x-pn-realaudio-plugin'; } if (/\.(swf|flv|mp4)(\?|$)/i.test(src)) { return'application/x-shockwave-flash'; } return'video/x-ms-asf-plugin'; }  修改jsp/upload_json.jsp的32行左右的上传功能的格式验证代码，加入需要支持的视频格式：
//定义允许上传的文件扩展名 HashMap<String, String> extMap = new HashMap<String, String>(); extMap.put(&#34;image&#34;, &#34;gif,jpg,jpeg,png,bmp&#34;); extMap.put(&#34;flash&#34;, &#34;swf,flv,mp4&#34;); extMap.put(&#34;media&#34;, &#34;swf,flv,mp3,wav,wma,wmv,mid,avi,mpg,asf,rm,rmvb,mp4&#34;); extMap.put(&#34;file&#34;, &#34;doc,docx,xls,xlsx,ppt,htm,html,txt,zip,rar,gz,bz2&#34;);  ckplayer官方称支持以下视频格式：
   视频协议 视频格式 Flash HTML5     HTTP flv g.jpg x.jpg   HTTP f4v g.jpg x.jpg   HTTP mp4 g."><link rel=stylesheet href=/css/styles.pcss integrity=><script>localStorage.theme==='dark'||!('theme'in localStorage)&&window.matchMedia('(prefers-color-scheme: dark)').matches?document.documentElement.classList.add('dark'):document.documentElement.classList.remove('dark')</script></head><body class="flex flex-col items-center w-full"><main class="w-full sm:w-10/12 md:w-9/12 lg:w-7/12 xl:w-5/12 m-auto px-6"><header class="mt-9 mb-8"><div class="flex justify-between items-center"><div class="flex items-center"><input id=navbar_btn class=hidden type=checkbox>
<label for=navbar_btn class="menu-btn mr-4 items-center flex xl:hidden"><span class=navicon></span></label><a href=/ class="font-bold text-lg xl:text-2xl mr-auto">My New Hugo Site</a></div><div class="flex items-center"><div class="cursor-pointer ml-2"><svg id="dark_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 15.31 23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31.0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg></svg><svg id="light_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g><path d="M0 0h24v24H0V0z" fill="none"/></g><g><g><g><path d="M14 2c1.82.0 3.53.5 5 1.35C16.01 5.08 14 8.3 14 12s2.01 6.92 5 8.65C17.53 21.5 15.82 22 14 22 8.48 22 4 17.52 4 12S8.48 2 14 2z"/></g></g></g></svg></svg></div></div></div><nav id=navbar class="mt-3 hidden xl:block"><ul class=flex></ul></nav><nav id=navbar_sm class="mt-2 hidden"><ul></ul><hr class=my-4></nav></header><div id=content class=my-8><div class="collapsible-menu-wrapper my-8 p-4 border-2 rounded"><div class="flex justify-between"><span class=font-bold>Table of contents</span></div><div class="collapsible-menu text-sm ml-2"><div class=leading-6><nav id=TableOfContents><ul><li><a href=#kindeditor>KindEditor</a><ul><li><a href=#ckplayer的配置>ckplayer的配置</a></li><li><a href=#修改格式验证代码>修改格式验证代码</a></li><li><a href=#修改embed标签代码>修改embed标签代码</a></li><li><a href=#注意>注意</a></li></ul></li><li><a href=#其他>其他</a><ul><li><a href=#修改上传提示>修改上传提示</a></li><li><a href=#视频播放去广告>视频播放去广告</a></li></ul></li><li><a href=#参考链接>参考链接</a></li></ul></nav></div></div></div><div class=my-7><article><p>[TOC]</p><p>  因项目需要，现将KindEditor与ckplayer相结合，搭建一个带本地视频播放的cms。</p><h2 id=kindeditor>KindEditor</h2><p>  KindEditor的安装与配置这里不做多余介绍，具体参考<a href=http://kindeditor.net/docs/usage.html>《官方文档-编辑器使用方法》</a>。</p><h3 id=ckplayer的配置>ckplayer的配置</h3><p>  上传相关文件到编辑器的插件目录即<code>editor/plugins/ckplayer</code>，基本的文件包括<code>ckplayer.js</code>、<code>ckplayer.swf</code>、<code>ckplayer.xml</code>、<code>language.xml</code>和<code>style.css</code>。</p><h3 id=修改格式验证代码>修改格式验证代码</h3><p>  修改kindeditor.js的960行左右的上传功能的格式验证代码，加入需要支持的视频格式：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>_mediaType</span>(<span style=color:#a6e22e>src</span>) {
    <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>/\.(rm|rmvb)(\?|$)/i</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>src</span>)) {
        <span style=color:#66d9ef>return</span><span style=color:#e6db74>&#39;audio/x-pn-realaudio-plugin&#39;</span>;
    }
    <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>/\.(swf|flv|mp4)(\?|$)/i</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>src</span>)) {
        <span style=color:#66d9ef>return</span><span style=color:#e6db74>&#39;application/x-shockwave-flash&#39;</span>;
    }
    <span style=color:#66d9ef>return</span><span style=color:#e6db74>&#39;video/x-ms-asf-plugin&#39;</span>;
}
</code></pre></div><p>  修改jsp/upload_json.jsp的32行左右的上传功能的格式验证代码，加入需要支持的视频格式：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>//定义允许上传的文件扩展名
</span><span style=color:#75715e></span>HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> extMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;();</span>
extMap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;image&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;gif,jpg,jpeg,png,bmp&#34;</span><span style=color:#f92672>);</span>
extMap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;flash&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;swf,flv,mp4&#34;</span><span style=color:#f92672>);</span>
extMap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;media&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;swf,flv,mp3,wav,wma,wmv,mid,avi,mpg,asf,rm,rmvb,mp4&#34;</span><span style=color:#f92672>);</span>
extMap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;file&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;doc,docx,xls,xlsx,ppt,htm,html,txt,zip,rar,gz,bz2&#34;</span><span style=color:#f92672>);</span>
</code></pre></div><p>  ckplayer官方称支持以下视频格式：</p><table><thead><tr><th style=text-align:center>视频协议</th><th style=text-align:center>视频格式</th><th style=text-align:center>Flash</th><th style=text-align:center>HTML5</th></tr></thead><tbody><tr><td style=text-align:center>HTTP</td><td style=text-align:center>flv</td><td style=text-align:center>g.jpg</td><td style=text-align:center>x.jpg</td></tr><tr><td style=text-align:center>HTTP</td><td style=text-align:center>f4v</td><td style=text-align:center>g.jpg</td><td style=text-align:center>x.jpg</td></tr><tr><td style=text-align:center>HTTP</td><td style=text-align:center>mp4</td><td style=text-align:center>g.jpg</td><td style=text-align:center>g.jpg</td></tr><tr><td style=text-align:center>HTTP</td><td style=text-align:center>m3u8</td><td style=text-align:center>g.jpg</td><td style=text-align:center>g.jpg</td></tr><tr><td style=text-align:center>HTTP</td><td style=text-align:center>webm</td><td style=text-align:center>x.jpg</td><td style=text-align:center>g.jpg</td></tr><tr><td style=text-align:center>HTTP</td><td style=text-align:center>ogg</td><td style=text-align:center>x.jpg</td><td style=text-align:center>g.jpg</td></tr><tr><td style=text-align:center>RTMP</td><td style=text-align:center>flv</td><td style=text-align:center>g.jpg</td><td style=text-align:center>x.jpg</td></tr><tr><td style=text-align:center>RTMP</td><td style=text-align:center>f4v</td><td style=text-align:center>g.jpg</td><td style=text-align:center>x.jpg</td></tr><tr><td style=text-align:center>RTMP</td><td style=text-align:center>mp4</td><td style=text-align:center>g.jpg</td><td style=text-align:center>x.jpg</td></tr><tr><td style=text-align:center>RTMP</td><td style=text-align:center>直播流</td><td style=text-align:center>g.jpg</td><td style=text-align:center>x.jpg</td></tr></tbody></table><p>  所以其中要添加什么类型的文件记得在两个文件都修改。</p><h3 id=修改embed标签代码>修改embed标签代码</h3><p>  ckplayer播放本地视频的原理是调用ckplayer.swf打开本地的视频，下面的修改kindeditor.js中983行左右embed标签相关的代码，加入ckplayer可以识别的参数flashvars：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>_mediaEmbed</span>(<span style=color:#a6e22e>attrs</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>html</span> <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&lt;embed&#39;</span>;
    <span style=color:#a6e22e>_each</span>(<span style=color:#a6e22e>attrs</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>val</span>) {
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>==</span><span style=color:#e6db74>&#39;src&#39;</span>) {
            <span style=color:#a6e22e>html</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;=&#34;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>K</span>.<span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>pluginsPath</span>
                    <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;ckplayer/ckplayer.swf&#34;&#39;</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;flashvars=&#34;f=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>localhostPath</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>val</span>
                    <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;&#34;&#39;</span>;
        } <span style=color:#66d9ef>else</span> {
            <span style=color:#a6e22e>html</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;=&#34;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;&#34;&#39;</span>;
        }
    });
    <span style=color:#a6e22e>html</span> <span style=color:#f92672>+=</span><span style=color:#e6db74>&#39;/&gt;&#39;</span>;
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>html</span>;
}
</code></pre></div><h3 id=注意>注意</h3><p>大约在kindeditor.js的300行左右，会有如下代码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>embed</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#e6db74>&#39;class&#39;</span>, <span style=color:#e6db74>&#39;src&#39;</span>, <span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;height&#39;</span>, <span style=color:#e6db74>&#39;type&#39;</span>, <span style=color:#f92672>\</span>
        <span style=color:#e6db74>&#39;loop&#39;</span>, <span style=color:#e6db74>&#39;autostart&#39;</span>, <span style=color:#e6db74>&#39;quality&#39;</span>, <span style=color:#e6db74>&#39;.width&#39;</span>, <span style=color:#e6db74>&#39;.height&#39;</span>, <span style=color:#f92672>\</span>
        <span style=color:#e6db74>&#39;align&#39;</span>, <span style=color:#e6db74>&#39;allowscriptaccess&#39;</span>, <span style=color:#e6db74>&#39;flashvars&#39;</span>],
</code></pre></div><p>  这段代码表示的是embed标签里的属性名，记得添加ckplayer专用的代表本地视频地址的<code>flashvars</code>参数，否则在KindEditor编辑器将代码转换成HTML代码时，embed标签中的其它参数会被省略。</p><p>  修改之后，当插入视频时，将会生成如下代码其中flashvars的其它参数可以通过&来连接更多的参数，如控制自动播放的p参数。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>embed</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:8080/editor/plugins/ckplayer/ckplayer.swf&#34;</span> <span style=color:#a6e22e>flashvars</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;f=/attached/flash/20160116/20160116131808_254.mp4&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;application/x-shockwave-flash&#34;</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;550&#34;</span> <span style=color:#a6e22e>height</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;400&#34;</span> <span style=color:#a6e22e>quality</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;high&#34;</span> /&gt;

</code></pre></div><h2 id=其他>其他</h2><p>  还有一些关于编辑器和优化如下：</p><h3 id=修改上传提示>修改上传提示</h3><p>  修改 <code>editor/plugins/flash/flash.js</code> ，在html参数中如添加诸如一下代码，引导管理员更好的使用上传本地视频的功能。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>html</span> <span style=color:#f92672>=</span> [
   <span style=color:#e6db74>&#39;&lt;div style=&#34;padding:20px;&#34;&gt;&#39;</span>,
    <span style=color:#75715e>//url
</span><span style=color:#75715e></span>   <span style=color:#e6db74>&#39;&lt;div class=&#34;ke-dialog-row&#34;&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;div style=&#34;color:red&#34;&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;本地视频上传详见&lt;a href=&#34;http://haha.tk&#34;  target=&#34;_blank&#34; &gt;《教程吧啦吧啦》&lt;/a&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;/div&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;label for=&#34;keUrl&#34; style=&#34;width:60px;&#34;&gt;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>lang</span>.<span style=color:#a6e22e>url</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;&lt;/label&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;input class=&#34;ke-input-text&#34; type=&#34;text&#34; id=&#34;keUrl&#34; name=&#34;url&#34; value=&#34;&#34; style=&#34;width:160px;&#34; /&gt; &amp;nbsp;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;input type=&#34;button&#34; class=&#34;ke-upload-button&#34; value=&#34;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>lang</span>.<span style=color:#a6e22e>upload</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;&#34; /&gt; &amp;nbsp;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;span class=&#34;ke-bu
</span><span style=color:#e6db74>    tton-common ke-button-outer&#34;&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;input type=&#34;button&#34; class=&#34;ke-button-common ke-button&#34; name=&#34;viewServer&#34; value=&#34;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>lang</span>.<span style=color:#a6e22e>viewServer</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#39;&#34; /&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;/span&gt;&#39;</span>,
   <span style=color:#e6db74>&#39;&lt;/div&gt;&#39;</span>,    
</code></pre></div><h3 id=视频播放去广告>视频播放去广告</h3><p>  将ckplayer.xml中setup参数的第9个值设置成0，具体参考 <a href=http://www.ckplayer.com/tool/#p_3_6_23>官方文档</a>。</p><h2 id=参考链接>参考链接</h2><ul><li>ckplayer 6.7<ul><li><a href="http://www.ckplayer.com/bbs/forum.php?mod=viewthread&tid=10864">ckplayer 6.7</a></li></ul></li><li>KindEditor4.1.10 (2013-11-23)<ul><li><a href=http://kindeditor.net/down.php>kindeditor</a></li></ul></li><li>参考教程<ul><li><a href="http://www.ckplayer.com/bbs/forum.php?mod=viewthread&tid=8961&highlight=kindeditor">关于kindeditor整合万能的ckplayer视频播放器插件</a>。</li></ul></li></ul></article></div></div></main><script src=/js/header.0b11855b871cb4d10c6c07b6723b9209f5c2bc9100735ab6ff47c8f9b76bb3d6ae41b488083b5fb15697987334039eb651b25c83228c29ac48a2bc168db8a894.js integrity="sha512-CxGFW4cctNEMbAe2cjuSCfXCvJEAc1q2/0fI+bdrs9auQbSICDtfsVaXmHM0A562UbJcgyKMKaxIorwWjbiolA=="></script><script src=/js/zooming.js integrity></script><script src=/js/code-copy-btn.js integrity></script></body></html>